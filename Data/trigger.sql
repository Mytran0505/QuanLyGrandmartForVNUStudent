SELECT STUDENT_ID,SUM(TRUNC(TOTAL_MONEY/100000))
FROM BILL
GROUP BY STUDENT_ID
ORDER BY STUDENT_ID;


CREATE OR REPLACE TRIGGER TRIGGER_POINT_INS_UPD 
AFTER INSERT OR UPDATE OF TOTAL_MONEY ON BILL
FOR EACH ROW
BEGIN
        UPDATE STUDENT
        SET POINT = POINT + TRUNC(:NEW.TOTAL_MONEY/100000)
        WHERE STUDENT_ID=:NEW.STUDENT_ID;
        
        UPDATE STUDENT
        SET SPENT_MONEY = SPENT_MONEY + :NEW.TOTAL_MONEY
        WHERE STUDENT_ID=:NEW.STUDENT_ID;
END;

CREATE OR REPLACE TRIGGER TRIGGER_POINT_DEL 
BEFORE DELETE ON BILL
FOR EACH ROW
BEGIN
        UPDATE STUDENT
        SET POINT = POINT - TRUNC(:OLD.TOTAL_MONEY/100000)
        WHERE STUDENT_ID=:OLD.STUDENT_ID;
        
        UPDATE STUDENT
        SET SPENT_MONEY = SPENT_MONEY - :OLD.TOTAL_MONEY
        WHERE STUDENT_ID=:OLD.STUDENT_ID;
END;


